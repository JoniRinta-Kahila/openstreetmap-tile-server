os: linux
language: minimal
services:
- docker
# DOCKER_USERNAME/DOCKER_PASSWORD have been configured in Travis CI
# env:
before_install:
- echo "Before install"
before_script:
- docker pull JoniRinta-Kahila/openstreetmap-tile-server || true
script:
- docker build --pull --cache-from JoniRinta-Kahila/openstreetmap-tile-server --tag JoniRinta-Kahila/openstreetmap-tile-server .
- docker volume create osm-data
- docker run --rm -v osm-data:/data/database/ JoniRinta-Kahila/openstreetmap-tile-server import
- docker run --rm -v osm-data:/data/database/ -p 8080:80 -d JoniRinta-Kahila/openstreetmap-tile-server run
- sleep 30
- make DOCKER_IMAGE=JoniRinta-Kahila/openstreetmap-tile-server stop
after_script:
- docker images
after_success:
- if [[ "$TRAVIS_BRANCH" == "master" ]];
  then
  docker images ;
  echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin ;
  docker push JoniRinta-Kahila/openstreetmap-tile-server ;
  fi
notifications:
  email: true
